{% extends 'base.html' %}
{% block title %}{{ page_name }}{% endblock %}

{% load i18n %}
{% load league_tags %}
{% block content %}
<div class="text-center">
<h1 class="mt-4">{{season}}</h1> <h2><a href="{% url 'season' season.slug %}">{{season.name}}</a></h2>
</div>
<div class='text-center m-3'><a class="page-link" href="#" onclick="openMembers(event)"><i class="fas fa-table"></i> Members</a> | <a class="page-link" href="#" onclick="openTeams(event)"><i class="fas fa-list"></i> Teams </a>| <a class="page-link" href="#" onclick="openFixtures(event)"><i class="fas fa-list"></i> Fixtures </a>

<div class = "col-md-8 ml-auto mr-auto d-none" id="members">
  {% include 'content/team_roster.html' with roster=members %}
</div>

<div class = "col-md-8 ml-auto mr-auto d-none" id="fixtures">
  <table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
          <th class="text-center w-20"></th>
          <th class="text-center w-20"></th>
          <th class="text-center w-20"><i class="fas fa-chess"></i></th>
          <th class="text-center w-10">{% trans "Result" %}</th>
          <th class="text-center w-20"><i class="fas fa-chess"></i></th>
        </tr>
      </thead>
      <tbody>
      {% for match in fixtures %}
      <tr>           
        <td class="text-center">{{match.date.date}}</td>
        <td class="text-center">{{match.team.league}}</td>
        <td class="text-center">{{match.team.name}}</td>
          <td class="text-center">{{match.print_result|safe}}</td>
          <td class="text-center">{{match.opponent}}</td>
      </tr>
      {% endfor %}
             </tbody>
      </table>
  </div>

</div>


<div class = "col-md-8 ml-auto mr-auto d-none" id = "teams">

  <div class="tab d-flex justify-content-center">
    <button class="tablinks" id="tablink-previous" onclick="previous(event)" > < </button>
    <button id = 'team-current'>{{team}}</button>
    <button class="tablinks" id = "tablink-next" onclick="next(event)"> > </button>
  </div>
  {% for team,players in teams.items %}
  <div class = "tabcontent" id = "team-{{forloop.counter0}}">
    {{team.league}}
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <th colspan="2">Squad</th>
        </thead>
        <thead>
        <th class="text-center w-60">{% trans "Player" %}</th>
        <th class="text-center w-20">Rating</th>
        </tr>
        </thead>
        <tbody>
        {% for player in players %}
              <tr>           
                <td class="text-center">{{player}}</td>
                <td class="text-center">{{player.rating}}</td>
              </tr>
              {% endfor %}
        </tbody>
        </table>
          </div>
  {% endfor %}
  


</div>
{% endblock %}

{% block scripts %}
<script>

var teamTexts  = [];
{% for team,players in teams.items %}
teamTexts.push( '{{team.name}}' );
{% endfor %}
var currentTeam = teamTexts[0];

function openMembers(e){
  var members = document.getElementById("members");
  var teams   = document.getElementById("teams");
  var fixtures   = document.getElementById("fixtures");

  if (members.classList.contains("d-none")) members.classList.remove("d-none");
  if (!teams.classList.contains("d-none")) teams.classList.add("d-none");
  if (!fixtures.classList.contains("d-none")) fixtures.classList.add("d-none");


  sessionStorage.setItem('showMembers',true);
  sessionStorage.setItem('showTeams',false);
  sessionStorage.setItem('showFixtures',false);

}

function openFixtures(e){
  var members = document.getElementById("members");
  var teams   = document.getElementById("teams");
  var fixtures   = document.getElementById("fixtures");

  if (fixtures.classList.contains("d-none")) fixtures.classList.remove("d-none");
  if (!teams.classList.contains("d-none")) teams.classList.add("d-none");
  if (!members.classList.contains("d-none")) members.classList.add("d-none");


  sessionStorage.setItem('showMembers',false);
  sessionStorage.setItem('showTeams',false);
  sessionStorage.setItem('showFixtures',true);

}

function openTeams(e){
  var members = document.getElementById("members");
  var teams   = document.getElementById("teams");
  var fixtures   = document.getElementById("fixtures");


  if (!members.classList.contains("d-none")) members.classList.add("d-none");
  if (teams.classList.contains("d-none")) teams.classList.remove("d-none");
  if (!fixtures.classList.contains("d-none")) fixtures.classList.add("d-none");

  sessionStorage.setItem('showMembers',false);
  sessionStorage.setItem('showFixtures',false);
  sessionStorage.setItem('showTeams',true);
}


function openTeam(e, team) {
  // Declare all variables
  var i, tabcontent, tablinks;
  // Get all elements with class="tabcontent" and hide them
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  document.getElementById('team-'+team).style.display = "block";
  currentTeam = teamTexts[team];

  document.getElementById('team-current').innerText=currentTeam;
  sessionStorage.setItem('showTeams', team);

  
}

function previous(e){
  var i = teamTexts.indexOf(currentTeam);
  if (i > 0 ) openTeam(e,i-1);
}

function next(e){
  var i = teamTexts.indexOf(currentTeam);
  if (i != -1 && i < teamTexts.length-1 ) openTeam(e,i+1);
}

window.onload = function(e){
  var teamTexts = [];
  {% for team,players in teams.items %}
  teamTexts.push( '{{team.name}}' );
  {% endfor %}
  var currentTeam = teamTexts[0];

  var showMembers = window.sessionStorage.getItem('showMembers');
  var showTeams   = window.sessionStorage.getItem('showTeams');
  var showFixtures   = window.sessionStorage.getItem('showFixtures');
  openTeam(e, 0);

  if (showTeams == "true") {
    openTeams(e);
  }
  else if (showFixtures == "true"){
    openFixtures(e);
  }
  else {
    openMembers(e);
  }
}
</script>
{% endblock %}